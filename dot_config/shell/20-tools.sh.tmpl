# 20-tools.sh - Tools management (shared between bash and zsh)

# Detect current shell
if [ -n "$BASH_VERSION" ]; then
  CURRENT_SHELL="bash"
elif [ -n "$ZSH_VERSION" ]; then
  CURRENT_SHELL="zsh"
else
  CURRENT_SHELL="unknown"
fi

{{if not .remote -}}
# setup gpg-agent ssh
unset SSH_AGENT_PID
if [ "${gnupg_SSH_AUTH_SOCK_by:-0}" -ne $$ ]; then
  export SSH_AUTH_SOCK="$(gpgconf --list-dirs agent-ssh-socket)"
fi
{{- end}}

# Homebrew - enable if found
# macOS: Homebrew is typically at /usr/local/bin/brew or /opt/homebrew/bin/brew
# Linux: Homebrew is typically at /home/linuxbrew/.linuxbrew/bin/brew
if [ -f /usr/local/bin/brew ]; then
  eval "$(/usr/local/bin/brew shellenv)"
elif [ -f /opt/homebrew/bin/brew ]; then
  eval "$(/opt/homebrew/bin/brew shellenv)"
elif [ -f /home/linuxbrew/.linuxbrew/bin/brew ]; then
  eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
fi

# activate mise
if command -v mise >/dev/null; then
  eval "$(mise activate $CURRENT_SHELL)"
fi

# enable the starship prompt
if command -v starship >/dev/null; then
  source <(starship init $CURRENT_SHELL)
fi

# fzf - fuzzy finder with key bindings and completion
if command -v fzf >/dev/null; then
  if [ "$CURRENT_SHELL" = "bash" ]; then
    source <(fzf --bash)
  elif [ "$CURRENT_SHELL" = "zsh" ]; then
    source <(fzf --zsh)
  fi
fi

# kubectl - Kubernetes CLI completion
if command -v kubectl >/dev/null; then
  source <(kubectl completion $CURRENT_SHELL)
fi

# flux - GitOps toolkit completion
if command -v flux >/dev/null; then
  source <(flux completion $CURRENT_SHELL)
fi

# zoxide - smarter cd command
if command -v zoxide >/dev/null; then
  source <(zoxide init $CURRENT_SHELL)
fi

# bat - better cat with syntax highlighting
if command -v bat >/dev/null; then
  if [ "$CURRENT_SHELL" = "bash" ]; then
    source <(bat --completion bash)
  fi
  # zsh: bat completion is typically installed via package manager
fi

# chezmoi - dotfile manager
if command -v chezmoi >/dev/null; then
  if [ "$CURRENT_SHELL" = "bash" ]; then
    source <(chezmoi completion bash)
  fi
  # zsh: chezmoi completion is typically installed via package manager
fi

# eza - modern ls replacement
if command -v eza >/dev/null; then
  if [ "$CURRENT_SHELL" = "bash" ]; then
    # eza bash completion is typically installed via package manager
    # or can be sourced from: https://github.com/eza-community/eza/blob/main/completions/bash/eza
    [[ -f /usr/share/bash-completion/completions/eza ]] && source /usr/share/bash-completion/completions/eza
  elif [ "$CURRENT_SHELL" = "zsh" ]; then
    # eza zsh completion is typically in fpath
    # or can be sourced from: https://github.com/eza-community/eza/blob/main/completions/zsh/_eza
    [[ -f /usr/share/zsh/site-functions/_eza ]] && source /usr/share/zsh/site-functions/_eza
  fi
fi

# yazi - terminal file manager
# Note: yazi doesn't have built-in completion generation
# Completions are typically installed via package manager or manually

# tmux - terminal multiplexer
# Note: tmux doesn't have built-in completion generation
# Completions are typically installed via package manager or manually

# uv - Python package installer
if command -v uv >/dev/null; then
  if [ "$CURRENT_SHELL" = "bash" ]; then
    source <(uv generate-shell-completion bash)
  fi
  # zsh: uv completion is typically installed via package manager
fi

# npm - Node package manager (from node)
if command -v npm >/dev/null; then
  if [ "$CURRENT_SHELL" = "bash" ]; then
    source <(npm completion)
  fi
  # zsh: npm completion is typically installed via package manager or use zsh-completions
fi

