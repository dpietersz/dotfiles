#!/bin/bash
set -euo pipefail

{{- if not .isMacOS }}
exit 0
{{- end }}

# Install Homebrew packages on macOS
if ! command -v brew >/dev/null; then
  echo "Homebrew not installed. Skipping package installation."
  exit 1
fi

echo "ðŸ“¦ Installing Homebrew packages..."

# Add taps first
echo "Adding Homebrew taps..."
brew tap nikitabobko/tap
brew tap amar1729/formulae

# Core tools (formulas - required for decryption and other early steps)
echo "Installing core tools (formulas)..."
brew install age gnupg mise pass pinentry

# Development tools (formulas)
echo "Installing development tools (formulas)..."
brew install ghostty kitty zed vscodium browserpass espanso llm tailscale tldr

# CLI tools (formulas)
echo "Installing CLI tools (formulas)..."
brew install btop ffmpeg flyctl gh railway tmux tree yt-dlp

# Docker tools (formulas)
echo "Installing Docker tools (formulas)..."
brew install colima docker docker-compose docker-buildx docker-credential-helper

# Applications (casks)
echo "Installing applications (casks)..."
brew install --cask \
  nikitabobko/tap/aerospace \
  arq \
  azure-data-studio \
  beekeeper-studio \
  bruno \
  cleanmymac \
  displaylink \
  granola \
  legcord \
  microsoft-azure-storage-explorer \
  microsoft-teams \
  obsidian \
  polypane \
  rapidapi \
  raycast \
  superwhisper \
  tailscale \
  ungoogled-chromium \
  zen

echo "âœ… Homebrew packages installed successfully"
