#!/bin/bash
{{- if not .remote }}

set -euo pipefail

# Set bash as default shell

# Check if bash is installed
if ! command -v bash >/dev/null 2>&1; then
  echo "Error: bash is not installed"
  exit 1
fi

# Get the path to bash
BASH_PATH=$(which bash)

# Check if bash is already in /etc/shells
if ! grep -q "^${BASH_PATH}$" /etc/shells 2>/dev/null; then
  echo "Adding bash to /etc/shells..."
  echo "$BASH_PATH" | sudo tee -a /etc/shells > /dev/null
fi

# Check if bash is already the default shell
CURRENT_SHELL=$(getent passwd "$USER" | cut -d: -f7)
if [ "$CURRENT_SHELL" = "$BASH_PATH" ]; then
  echo "bash is already the default shell"
  exit 0
fi

# Set bash as default shell
echo "Setting bash as default shell..."
sudo usermod -s "$BASH_PATH" "$USER"

echo "✓ bash set as default shell"
echo "⚠️  You need to log out and log back in for the change to take effect"

{{- end }}

