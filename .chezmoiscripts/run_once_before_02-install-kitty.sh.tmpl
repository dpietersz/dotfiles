#!/bin/bash
set -euo pipefail
{{- if not .remote }}

{{- if or .isBluefin .isFedora }}

# Check if kitty is already installed
if command -v kitty >/dev/null 2>&1; then
   echo "Kitty is already installed"
   exit 0
fi

{{- if .isBluefin }}
# Clean up old ghostty COPR repository if it exists
if [ -f /etc/yum.repos.d/_copr:copr.fedorainfracloud.org:scottames:ghostty.repo ]; then
   echo "Removing old Ghostty COPR repository..."
   sudo rm -f /etc/yum.repos.d/_copr:copr.fedorainfracloud.org:scottames:ghostty.repo
fi

echo "Installing Kitty terminal..."
echo "Refreshing package metadata..."
sudo rpm-ostree refresh-md

echo "Installing Kitty..."
sudo rpm-ostree install kitty

echo "✓ Kitty installed successfully"
echo "⚠️  A reboot is required to apply changes"
echo "Run: systemctl reboot"

{{- else if .isFedora }}
echo "Installing Kitty terminal..."
sudo dnf install -y kitty
echo "✓ Kitty installed successfully"

{{- end }}

{{- else }}
echo "Kitty installation is only supported on Bluefin and Fedora"
exit 0

{{- end }}
{{- end }}
