#!/bin/bash

set -euo pipefail

# ------------------ fabric CLI install ------------------
# Installs fabric CLI tool from danielmiessler/fabric
# Source: https://github.com/danielmiessler/fabric
#
# Installation method: curl-pipe-bash (official installer)
# - Main installer: https://raw.githubusercontent.com/danielmiessler/fabric/main/scripts/installer/install.sh
# - Completions: https://raw.githubusercontent.com/danielmiessler/Fabric/refs/heads/main/completions/setup-completions.sh
#
# Skips on remote environments (per .chezmoi.toml.tmpl data.remote)

{{- if .remote }}
echo "[fabric] Skipping install: remote environment (.remote=true)"
exit 0
{{- end }}

# ------------------ Check if already installed ------------------
if command -v fabric >/dev/null 2>&1; then
  echo "[fabric] Already installed: $(fabric --version 2>/dev/null || echo 'version unknown')"
  exit 0
fi

# ------------------ Install fabric CLI ------------------
echo "[fabric] Installing fabric CLI..."
curl -fsSL https://raw.githubusercontent.com/danielmiessler/fabric/main/scripts/installer/install.sh | bash

# ------------------ Install shell completions ------------------
echo "[fabric] Installing shell completions..."
curl -fsSL https://raw.githubusercontent.com/danielmiessler/Fabric/refs/heads/main/completions/setup-completions.sh | sh

echo "[fabric] Installation complete."
