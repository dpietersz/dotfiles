#!/bin/bash
{{- if not .remote }}

# Check if already installed
if command -v syncthing >/dev/null; then
  echo "Syncthing already installed"
  exit 0
fi

{{- if eq .chezmoi.os "darwin" }}
if command -v brew >/dev/null; then
  brew install syncthing
  brew services start syncthing
  echo "Syncthing started as a service"
else
  echo "Homebrew not installed. Visit: https://syncthing.net"
fi

{{- else if eq .chezmoi.osRelease.id "bluefin" }}
# Bluefin - use rpm-ostree (Syncthing is in official Fedora repos)
rpm-ostree install syncthing
echo "Reboot required to complete Syncthing installation"
echo "Service will be enabled automatically after reboot"

{{- else if or (eq .chezmoi.osRelease.id "fedora") (eq .chezmoi.osRelease.idLike "fedora") }}
# Fedora - Syncthing is in official repos
if command -v dnf >/dev/null; then
  sudo dnf install -y syncthing
  systemctl --user enable --now syncthing
  echo "Syncthing service enabled and started"
fi

{{- else }}
echo "No installation instructions for this distribution."
echo "Visit: https://syncthing.net"

{{- end }}
{{- end }}
