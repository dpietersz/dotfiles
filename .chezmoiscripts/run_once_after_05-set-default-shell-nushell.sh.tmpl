#!/bin/bash
{{- if not .remote }}

set -euo pipefail

# Set nushell as default shell
# Reference: https://www.nushell.sh/book/installation.html

# Check if nushell is installed
if ! command -v nu >/dev/null 2>&1; then
  echo "Error: nushell is not installed"
  exit 1
fi

# Get the path to nushell
NU_PATH=$(which nu)

# Check if nushell is already in /etc/shells
if ! grep -q "^${NU_PATH}$" /etc/shells 2>/dev/null; then
  echo "Adding nushell to /etc/shells..."
  echo "$NU_PATH" | sudo tee -a /etc/shells > /dev/null
fi

# Check if nushell is already the default shell
if [ "$SHELL" = "$NU_PATH" ]; then
  echo "nushell is already the default shell"
  exit 0
fi

# Set nushell as default shell using usermod
echo "Setting nushell as default shell..."
if command -v chsh >/dev/null 2>&1; then
  # Use chsh if available (preferred for user-level changes)
  chsh -s "$NU_PATH"
elif command -v usermod >/dev/null 2>&1; then
  # Fall back to usermod (works on most Linux systems)
  sudo usermod -s "$NU_PATH" "$USER"
else
  echo "Warning: Neither chsh nor usermod found. Cannot set default shell."
  echo "Please manually set nushell as your default shell."
  exit 0
fi

echo "✓ Default shell changed to nushell"
echo "⚠️  Please log out and log back in for the change to take effect"

{{- end }}

