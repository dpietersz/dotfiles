#!/bin/bash
{{- if not .remote }}

{{- if or (eq .chezmoi.osRelease.id "bluefin") (eq .chezmoi.osRelease.id "fedora") }}

set -euo pipefail

# Install niri and waybar on Fedora/Bluefin
# Reference: https://github.com/YaLTeR/niri/wiki

# Check if niri is already installed
if command -v niri >/dev/null 2>&1; then
  echo "niri is already installed"
  exit 0
fi

echo "Installing niri and waybar..."

# Get Fedora version
. /etc/os-release
FEDORA_VERSION="${VERSION_ID:-42}"

# Enable COPR repository for niri
echo "Adding niri COPR repository..."
sudo dnf copr enable -y yalter/niri

# Refresh metadata
echo "Refreshing package metadata..."
sudo rpm-ostree refresh-md --force

# Install niri and waybar
echo "Installing niri and waybar..."
sudo rpm-ostree install niri waybar

echo "✓ Niri and waybar installed successfully"
echo "⚠️  A reboot is required to apply changes"
echo "Run: systemctl reboot"

{{- else }}
echo "Niri installation is only supported on Bluefin and Fedora"
exit 0

{{- end }}
{{- end }}

