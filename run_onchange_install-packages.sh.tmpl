{{- $commonPackages := list "tmux" "less" "ripgrep" "entr" "bat" "zsh" "pass" "direnv" "git-lfs" "fzf" "wireguard-tools" -}}

{{- $linuxPackages  := list "fd-find" -}}

{{- $debianPackages := list "shellcheck" lsd" -}}
{{- $fedoraPackages := list "ShellCheck" "procs" "lsd" "git-delta" -}}

{{- $brewPackages   := list "fd" "shellcheck" "kind" "k3d" "k9s" "python" "procs" "bottom" "neovim" "starship" "go-task/tap/go-task" -}}
{{- $caskPackages   := list "alacritty" "homebrew/cask-fonts/font-fira-code-nerd-font" -}}

#!/bin/bash
{{ if eq .chezmoi.os "linux" -}}

{{- if or (eq .chezmoi.osRelease.id "ubuntu" "debian") -}}

{{- if eq .chezmoi.osRelease.versionID "10" -}}
{{- $commonPackages = without $commonPackages "bat" "wireguard-tools" -}}
{{- end -}}

sudo apt update
sudo apt install --no-install-recommends -y {{ concat $commonPackages $linuxPackages $debianPackages | join " " }}

{{- else if eq .chezmoi.osRelease.id "fedora" -}}
sudo dnf install -y {{ concat $commonPackages $linuxPackages $fedoraPackages | join " "}}

{{ if eq .chezmoi.osRelease.variantID "workstation" "kde" -}}
sudo dnf install -y alacritty
{{- end -}}

{{- end -}}

{{- else if (eq .chezmoi.os "darwin") -}}

# note you should use rancher desktop for now. Lima didn't really work for me.
# rancher desktop provides:
# - kubectl
# - docker
# - docker-compose
# - docker-buildx
# - helm
# - nerdctl

brew install --cask {{ $caskPackages | join " "}}
brew install {{ concat $commonPackages $brewPackages | join " "}}

{{- end }}
