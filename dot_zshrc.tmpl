{{- $remote := env "REMOTE_CONTAINERS" | not | not -}}

# Path to your oh-my-zsh installation.
export ZSH="$HOME/.oh-my-zsh"

# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

ZSH_THEME="powerlevel10k/powerlevel10k"
DISABLE_AUTO_UPDATE=true

plugins=(
  git
  pass
  fzf
  pj
  tmux
  kubectl
  zsh-autosuggestions
)

# pj config
{{if eq .chezmoi.hostname "megatron" -}}
PROJECT_PATHS=(~/code/gitlab.com/RioKierkels ~/code/github.com/rio)

{{else if eq .chezmoi.hostname "soundwave" -}}
PROJECT_PATHS=(~/code/gitlab.com/fullstaq-projects ~/code/github.com/rio)

{{- end}}

# tmux config
{{if $remote -}} ZSH_TMUX_AUTOSTART=false {{- else -}} ZSH_TMUX_AUTOSTART=true {{- end}}
ZSH_TMUX_AUTOSTART_ONCE=true
ZSH_TMUX_AUTOCONNECT=false
ZSH_TMUX_FIXTERM=true

# edit PATH
{{ if eq .chezmoi.os "linux" -}}
export PATH=$HOME/.cargo/bin:$HOME/.local/bin:$PATH

{{- else if eq .chezmoi.hostname "FVFFM0E5Q05Q" -}}
export PATH=$HOME/Library/Python/3.10/bin:$HOME/.rd/bin:$PATH

{{- end}}

source $ZSH/oh-my-zsh.sh

{{if not $remote -}}
# setup gpg-agent ssh
unset SSH_AGENT_PID
if [ "${gnupg_SSH_AUTH_SOCK_by:-0}" -ne $$ ]; then
        export SSH_AUTH_SOCK="$(gpgconf --list-dirs agent-ssh-socket)"
fi
{{- end}}

# I need (neo)vim
export EDITOR='nvim'
export VISUAL='nvim'

{{if and .chezmoi.osRelease (eq .chezmoi.osRelease.id "ubuntu") -}} alias ll="exa -bghl" {{- else -}} alias ll="exa -bghl --git" {{- end}}

# enable usage of .envrc files
if command -v direnv > /dev/null ; then
  eval "$(direnv hook zsh)"
fi

# enable layer 8 error correction
if command -v thefuck > /dev/null ; then
  eval $(thefuck --alias slap)
fi

# syntax highlighting needs to be at the end because of reasons
source $ZSH_CUSTOM/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh
